<!--==============================================================-->
<!-- about.html                                                   -->
<!--==============================================================-->

<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Log Food</title>
    {% include 'bootstrap.html' %}
</head>


<body>
    {% include 'navbar.html' %}
    {% set current_page = 'logfood' %}

    <h1 class="text-center m-3">Log Food</h1> 
    <p class="custom-text-wrapper">
        Select your dining hall from the drop down below or search for the recipe name in the 
        search bar. Once you select your dish(es), estimate the number of servings you consumed 
        in the “My Plate” window below. 
    </p>
    
    <!-- Select buttons: Dining Hall, Mealtime -->
    <div class="row p-1">
        <div class="col-sm-3 m-5">
            <select class="form-select form-select-sm" id = "diningHallSelect" aria-label="select_dhall" style="background-color: rgb(250, 160, 58);">
              <option value="" selected>Select Dining Hall</option>
              <option value="Center for Jewish Life">Center for Jewish Life</option>
              <option value="Forbes College">Forbes College</option>
              <option value="Graduate College">Graduate College</option>
              <option value="Yeh & New West Colleges">Yeh & New West Colleges</option>
              <option value="Rockefeller & Mathey Colleges">Rockefeller & Mathey Colleges</option>
              <option value="Whitman & Butler Colleges">Whitman & Butler Colleges</option>
            </select>
        </div>
    </div>

    <!-- Tab Navs -->


    <!--Two cards: one for the food list, and one for My Plate-->
    <div class="row p-2">
      <div class="col-sm-6 m-3">

        <!-- Tab Navs -->
        <ul class="nav nav-tabs" id="mealTimeTab" role="tablist">
          <li class="custom-nav-item">
              <a class="nav-link active" id="Breakfast-tab" data-toggle="tab" href="#breakfast" role="tab" aria-controls="breakfast" aria-selected="true">Breakfast</a>
          </li>
          <li class="custom-nav-item">
              <a class="nav-link" id="Lunch-tab" data-toggle="tab" href="#lunch" role="tab" aria-controls="lunch" aria-selected="false">Lunch</a>
          </li>
          <li class="custom-nav-item">
              <a class="nav-link" id="Dinner-tab" data-toggle="tab" href="#dinner" role="tab" aria-controls="dinner" aria-selected="false">Dinner</a>
          </li>
        </ul>


        <div class="card">
          <div class="card-body" id="menu-items">
            {% for food in food_items %}
              <p class="card-text">{{food}}</p>
            {% endfor %}
          </div>
        </div>

      </div>
      <div class="col-sm-5 m-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">My Plate</h5>
            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="container p-5">
      <h4>Done adding food to your plate?</h4>
      <form action="/logfood" method="post" class="p-3">
        <button type="submit" name="upload_plate">Upload Plate and Return</button>
      </form>
    </div>

</body>
<!-- Bootstrap JS, Popper.js, and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="/static/js/script.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Event listener for the dropdown selection change
        var diningHallSelect = document.getElementById('diningHallSelect');
        console.log(diningHallSelect);
        if (diningHallSelect) {
          console.log(diningHallSelect);

          diningHallSelect.addEventListener('change', function() {
              var selectedHall = this.value; // Get the value of the selected option
              // Assume default or currently active mealtime
              var mealtime = $('.nav-tabs .active').attr('id').replace('-tab', '');
              
              console.log("Selected dining hall:", selectedHall, "Mealtime:", mealtime);
              
              // Make an AJAX request
              fetchMenuData(selectedHall, mealtime);
          });
        }

        // Listener for tab switch
        $('#mealTimeTab a').on('shown.bs.tab', function(event) {
            var selectedHall = diningHallSelect.value; // Ensure diningHallSelect is defined outside this listener for scope
            var mealtime = $(event.target).attr('id').replace('-tab', ''); // Extract mealtime from the id of the activated tab

            console.log("Mealtime switched to:", mealtime);

            // Make an AJAX request if a dining hall is selected
            if (selectedHall && selectedHall !== "Select Dining Hall") {
                fetchMenuData(selectedHall, mealtime);
            }
        });
    });

    function fetchMenuData(hallId, mealtime) {
        var url = '/logfood/data?dhall=' + encodeURIComponent(hallId) + '&mealtime=' + encodeURIComponent(mealtime);
        // var url = '/logfood/data?dhall=' + encodeURIComponent(hallId);

        fetch(url)
        .then(response => {
          if (response.headers.get("content-type").includes("application/json")) {
            return response.json();
          } else {
            throw new Error('Received non-JSON response from server');
          }
        })
        .then(data => {
          console.log(data)
          updateMealContent(data);
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    function updateMealContent(items) {
      const container = document.getElementById('menu-items');
      // Ensure the container exists
      if (container) {
          // Clear existing content
          container.innerHTML = '';

          if (Array.isArray(items) && items.length === 0) {
            // Handle no data case, e.g., display a message
            const p = document.createElement('p');
            p.textContent = "No data found.";
            container.appendChild(p);
          } else{
            // Create and append each food item as a <p> tag
            items.forEach(item => {
            const p = document.createElement('p');
            p.classList.add('card-text'); // Add the Bootstrap class for styling
            p.textContent = item; // Set the text content to the food item
            container.appendChild(p); // Append the paragraph to the container
          });
          }
          
      } else {
          console.error('Container not found for meal');
      }
    }
</script>
</html>